<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Parte Di√°ria da Obra</title>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>

  <style>
    body { font-family: Arial; padding: 20px; background: #f4f4f4; }
    .hidden { display: none; }
    input, select, button {
      padding: 6px; margin: 5px; border-radius: 4px; border: 1px solid #ccc;
    }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { padding: 8px; border: 1px solid #ccc; text-align: center; }
    th { background: #dcdcdc; }
    .form-container, .login-container {
      background: #fff; padding: 15px; border-radius: 6px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1); margin-bottom: 20px;
    }
    .btn-delete { color: red; cursor: pointer; }
  </style>
</head>
<body>

<h2>‚òÅÔ∏è Parte Di√°ria da Obra</h2>

<!-- üîê Login -->
<div class="login-container" id="login-section">
  <h3>Login</h3>
  <input type="email" id="email" placeholder="Email">
  <input type="password" id="senha" placeholder="Senha">
  <button onclick="login()">Entrar</button>
  <button onclick="registrar()">Cadastrar</button>
</div>

<!-- ‚úÖ App -->
<div id="app-section" class="hidden">
  <button onclick="logout()">Sair</button>

  <!-- Filtros -->
  <div>
    <label>Filtrar por Data: <input type="date" id="filtro-data"></label>
    <label>Prefixo: <input type="text" id="filtro-prefixo"></label>
    <label>Turno:
      <select id="filtro-turno">
        <option value="">Todos</option>
        <option value="Diurno">Diurno</option>
        <option value="Noturno">Noturno</option>
      </select>
    </label>
    <button onclick="carregarRegistros()">Filtrar</button>
  </div>

  <!-- Formul√°rio -->
  <div class="form-container">
    <label>Data: <input type="date" id="data"></label>
    <label>Prefixo: <input type="text" id="prefixo"></label>
    <label>Turno:
      <select id="turno">
        <option value="Diurno">Diurno</option>
        <option value="Noturno">Noturno</option>
      </select>
    </label><br>
    <label>IMETRO: <input type="number" id="imetro"></label>
    <label>RIMETRO: <input type="number" id="rimetro"></label>
    <label>Observa√ß√µes: <input type="text" id="obs"></label>
    <button onclick="adicionarRegistro()">Salvar</button>
  </div>

  <!-- Tabela -->
  <table>
    <thead>
      <tr>
        <th>Data</th>
        <th>Prefixo</th>
        <th>Turno</th>
        <th>IMETRO</th>
        <th>RIMETRO</th>
        <th>Horas</th>
        <th>Observa√ß√µes</th>
        <th>A√ß√µes</th>
      </tr>
    </thead>
    <tbody id="tabela"></tbody>
  </table>
</div>

<script>
  // Firebase config (sua config)
  const firebaseConfig = {
    apiKey: "AIzaSyD-nZdYV7ijYhZ5hRXJXsEdMpgDpPiorec",
    authDomain: "project-pd-s.firebaseapp.com",
    projectId: "project-pd-s",
    storageBucket: "project-pd-s.firebasestorage.app",
    messagingSenderId: "852298305347",
    appId: "1:852298305347:web:c510579f96cf6d177da9f6",
    measurementId: "G-YZ0K7RDLGY"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();
  const colecao = db.collection("partes-diarias");

  // Login & Autentica√ß√£o
  auth.onAuthStateChanged(user => {
    if (user) {
      document.getElementById('login-section').classList.add('hidden');
      document.getElementById('app-section').classList.remove('hidden');
      carregarRegistros();
    } else {
      document.getElementById('login-section').classList.remove('hidden');
      document.getElementById('app-section').classList.add('hidden');
    }
  });

  function login() {
    const email = document.getElementById('email').value;
    const senha = document.getElementById('senha').value;
    auth.signInWithEmailAndPassword(email, senha)
      .catch(e => alert("Erro no login: " + e.message));
  }

  function registrar() {
    const email = document.getElementById('email').value;
    const senha = document.getElementById('senha').value;
    auth.createUserWithEmailAndPassword(email, senha)
      .then(() => alert("Usu√°rio registrado!"))
      .catch(e => alert("Erro ao cadastrar: " + e.message));
  }

  function logout() {
    auth.signOut();
  }

  // CRUD
  function adicionarRegistro() {
    const data = document.getElementById("data").value;
    const prefixo = document.getElementById("prefixo").value;
    const turno = document.getElementById("turno").value;
    const imetro = parseFloat(document.getElementById("imetro").value);
    const rimetro = parseFloat(document.getElementById("rimetro").value);
    const obs = document.getElementById("obs").value;

    if (!data || !prefixo || isNaN(imetro) || isNaN(rimetro)) {
      alert("Preencha todos os campos obrigat√≥rios!");
      return;
    }

    colecao.add({ data, prefixo, turno, imetro, rimetro, obs })
      .then(() => {
        alert("Registro adicionado!");
        carregarRegistros();
        limparCampos();
      });
  }

  function carregarRegistros() {
    let query = colecao;

    const filtroData = document.getElementById("filtro-data").value;
    const filtroPrefixo = document.getElementById("filtro-prefixo").value.toUpperCase();
    const filtroTurno = document.getElementById("filtro-turno").value;

    if (filtroData) query = query.where("data", "==", filtroData);
    query.get().then(snapshot => {
      const tabela = document.getElementById("tabela");
      tabela.innerHTML = "";

      snapshot.forEach(doc => {
        const d = doc.data();

        if (filtroTurno && d.turno !== filtroTurno) return;
        if (filtroPrefixo && !d.prefixo.toUpperCase().includes(filtroPrefixo)) return;

        const horas = (d.rimetro - d.imetro).toFixed(2);
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${d.data}</td>
          <td>${d.prefixo}</td>
          <td>${d.turno}</td>
          <td>${d.imetro}</td>
          <td>${d.rimetro}</td>
          <td>${horas}</td>
          <td>${d.obs || ""}</td>
          <td><span class="btn-delete" onclick="excluirRegistro('${doc.id}')">üóëÔ∏è</span></td>
        `;
        tabela.appendChild(tr);
      });
    });
  }

  function excluirRegistro(id) {
    if (confirm("Excluir este registro?")) {
      colecao.doc(id).delete().then(carregarRegistros);
    }
  }

  function limparCampos() {
    ["data", "prefixo", "imetro", "rimetro", "obs"].forEach(id => document.getElementById(id).value = "");
  }
</script>

</body>
</html>
